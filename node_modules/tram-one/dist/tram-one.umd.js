!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("domino")):"function"==typeof define&&define.amd?define(["domino"],t):e["tram-one"]=t(e.domino)}(this,function(e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(e,t){return e(t={exports:{}},t.exports),t.exports}var r=n(function(t){var n="undefined"!=typeof window?window.document:e.createWindow().document,r=function(e){return"number"==typeof e||"boolean"==typeof e||"function"==typeof e||e instanceof Date||e instanceof RegExp?e.toString():e},o=function(e){return!("string"==typeof e&&/^[\n\r\s]+$/.test(e))},i=function(e,t){Array.isArray(t)&&t.map(r).filter(o).forEach(function(t){if(Array.isArray(t))i(e,t);else{if("string"==typeof t){if(e.lastChild&&"#text"===e.lastChild.nodeName)return void(e.lastChild.nodeValue+=t);t=n.createTextNode(t)}t&&t.nodeType&&e.appendChild(t)}})};t.exports=i}),o=n(function(t){var n="undefined"!=typeof window?window.document:e.createWindow().document,o=function(e){return!/^xmlns($|:)/i.test(e)},i=function(e){return"classname"===e.key.toLowerCase()?{key:"class",value:e.value}:e},u=function(e){return"htmlFor"===e.key?{key:"for",value:e.value}:e},s=function(e){return function(t,s,a){if("!--"===t)return n.createComment(s.comment);var c=e?n.createElementNS(e,t):n.createElement(t);return Object.keys(s).filter(o).filter(function(e){return function(t){return Object.prototype.hasOwnProperty.call(e,t)}}(s)).map(function(e){return function(t){return{key:t,value:e[t]}}}(s)).map(i).map(u).filter(function(e){return function(t){return"on"!==t.key.slice(0,2)||![e[t.key]=t.value]}}(c)).filter(function(e,t){return function(n){return!t||![e.setAttributeNS(null,n.key,n.value)]}}(c,e)).filter(function(e){return function(t){return e.setAttribute(t.key,t.value)}}(c)),r(c,a),c}};t.exports=s,t.exports.html=s(),t.exports.svg=s("http://www.w3.org/2000/svg")}),i=n(function(e){var t=function(e){return function(t,n){var r,o,i,u=void 0===e.getItem?e[n]:e.getItem(n);return Object.assign({},t,(r=n,(o=function(e){try{return JSON.parse(e)}catch(t){console.warn("hover-battery could not parse "+e)}}(u))?((i={})[r]={init:function(){return o}},i):{}))}};e.exports=function(e){return{listener:function(t){Object.keys(t).forEach(function(n){void 0===e.setItem?e[n]=JSON.stringify(t[n]):e.setItem(n,JSON.stringify(t[n]))})},actions:Object.keys(e).reduce(t(e),{})}}}),u=function(e){return Object.keys(e).map(function(t){return e[t]})},s=function(e,t){return e.concat(t)},a=function(){this.engine={},this.store={},this.actionQueue=[],this.listeners=[],this.actions={}};a.prototype.addActions=function(e){var t=this,n=function(e,t){var n,r=t.name in e?e[t.name].concat(t):[t];return Object.assign({},e,((n={})[t.name]=r,n))};this.engine=Object.keys(e).map(function(e){return function(t){return u(e[t]).map(function(e){return e._storeKey=t,e})}}(e)).reduce(function(e,t){return u(t).reduce(n,e)},this.engine);this.store=Object.keys(e).map(function(t){return{key:t,init:e[t].init}}).reduce(function(e,t){var n;return Object.assign({},e,((n={})[t.key]=t.init(),n))},this.store);return this.actions=u(e).map(function(e){return Object.keys(e)}).reduce(s,[]).reduce(function(e,n){var r;return Object.assign({},e,((r={})[n]=function(e){return function(e,n){var r=function(e){return function(n,r){var o;return Object.assign({},n,((o={})[r._storeKey]=r(n[r._storeKey],e.args,t.actions),o))}},o=0===t.actionQueue.length;for(t.actionQueue.push({actions:t.engine[e],args:n});o&&t.actionQueue.length>0;){var i=t.actionQueue[0],u=r(i);t.store=i.actions.reduce(u,t.store),t.actionQueue.shift(),t.notifyListeners(e,n)}}(n,e)},r))},this.actions),this},a.prototype.addListener=function(e){return this.listeners.push(e),this},a.prototype.notifyListeners=function(e,t){var n=this;return this.listeners.forEach(function(r){return r(n.store,n.actions,e,t)}),this};var c=a,l=["onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmousemove","onmouseout","onmouseenter","onmouseleave","ontouchcancel","ontouchend","ontouchmove","ontouchstart","ondragstart","ondrag","ondragenter","ondragleave","ondragover","ondrop","ondragend","onkeydown","onkeypress","onkeyup","onunload","onabort","onerror","onresize","onscroll","onselect","onchange","onsubmit","onreset","onfocus","onblur","oninput","oncontextmenu","onfocusin","onfocusout"],f=l.length,h=1,d=3,p=8,v=function(e,t){var n=e.nodeType,r=e.nodeName;n===h&&function(e,t){for(var n=t.attributes,r=e.attributes,o=null,i=null,u=null,s=null,a=r.length-1;a>=0;--a)s=r[a],u=s.name,o=s.namespaceURI,i=s.value,o?(u=s.localName||u,t.getAttributeNS(o,u)!==i&&t.setAttributeNS(o,u,i)):t.hasAttribute(u)?t.getAttribute(u)!==i&&("null"===i||"undefined"===i?t.removeAttribute(u):t.setAttribute(u,i)):t.setAttribute(u,i);for(var c=n.length-1;c>=0;--c)!1!==(s=n[c]).specified&&(u=s.name,(o=s.namespaceURI)?(u=s.localName||u,e.hasAttributeNS(o,u)||t.removeAttributeNS(o,u)):e.hasAttributeNS(null,u)||t.removeAttribute(u))}(e,t);n!==d&&n!==p||t.nodeValue!==e.nodeValue&&(t.nodeValue=e.nodeValue);"INPUT"===r?function(e,t){var n=e.value,r=t.value;g(e,t,"checked"),g(e,t,"disabled"),n!==r&&(t.setAttribute("value",n),t.value=n);"null"===n&&(t.value="",t.removeAttribute("value"));e.hasAttributeNS(null,"value")?"range"===t.type&&(t.value=n):t.removeAttribute("value")}(e,t):"OPTION"===r?function(e,t){g(e,t,"selected")}(e,t):"TEXTAREA"===r&&function(e,t){var n=e.value;n!==t.value&&(t.value=n);if(t.firstChild&&t.firstChild.nodeValue!==n){if(""===n&&t.firstChild.nodeValue===t.placeholder)return;t.firstChild.nodeValue=n}}(e,t);!function(e,t){for(var n=0;n<f;n++){var r=l[n];e[r]?t[r]=e[r]:t[r]&&(t[r]=void 0)}}(e,t)};function g(e,t,n){e[n]!==t[n]&&(t[n]=e[n],e[n]?t.setAttribute(n,""):t.removeAttribute(n))}var m=3,y=function(e,t){return b(t,e)};function b(e,t){return t?e?e.isSameNode&&e.isSameNode(t)?t:e.tagName!==t.tagName?e:(v(e,t),function(e,t){for(var n,r,o,i,u=0,s=0;n=t.childNodes[s],r=e.childNodes[s-u],n||r;s++)if(r)if(n)if(w(r,n))(o=b(r,n))!==n&&(t.replaceChild(o,n),u++);else{i=null;for(var a=s;a<t.childNodes.length;a++)if(w(t.childNodes[a],r)){i=t.childNodes[a];break}i?((o=b(r,i))!==i&&u++,t.insertBefore(o,n)):r.id||n.id?(t.insertBefore(r,n),u++):(o=b(r,n))!==n&&(t.replaceChild(o,n),u++)}else t.appendChild(r),u++;else t.removeChild(n),s--}(e,t),t):null:e}function w(e,t){return e.id?e.id===t.id:e.isSameNode?e.isSameNode(t):e.tagName===t.tagName&&(e.type===m&&e.nodeValue===t.nodeValue)}var A=n(function(e){var n,r,o;r=function(){return function(e,t){var n={},r=decodeURIComponent;return function(){for(var e in t)s(e,t[e])}(),function(t,u){var s=function(e){var t=function(e){return~e.indexOf("/?")&&(e=e.replace("/?","?")),"/"==e[0]&&(e=e.slice(1)),"/"==e[e.length-1]&&(e=e.slice(0,-1)),e}(e).split("?"),u=~e.indexOf("%")?r:o;return function(e,t,n){if(e&&t.cb)for(var r=e.indexOf("#"),o=(r<0?e:e.slice(0,r)).split("&"),i=0;i<o.length;++i){var u=o[i].split("=");t.params[u[0]]=n(u[1])}return t}(t[1],i(t[0].split("/"),u,0,n,[])||{},u)}(t);return(s.cb||e)(s.params,u,t)};function o(e){return e}function i(e,t,n,r,o){if(r){if(n>=e.length){var s=r["@"];return s&&{cb:s,params:o.reduce(function(e,t){return e[t[0]]=t[1],e},{})}}var a=t(e[n]),c=o.length;return i(e,t,n+1,r[a.toLowerCase()],o)||u(e,t,n+1,r,":",a,o,c)||u(e,t,e.length,r,"*",e.slice(n).join("/"),o,c)}}function u(e,t,n,r,o,u,s,a){s.length=a;var c=r[o];return c&&s.push([c["~"],u]),i(e,t,n,c,s)}function s(e,t){for(var r=e.split("/"),o=n,i=+("/"===e[0]);i<r.length;++i){var u=r[i],s=":"==u[0]?":":"*"==u[0]?"*":u.toLowerCase();o=o[s]||(o[s]={}),(":"==s||"*"==s)&&(o["~"]=u.slice(1))}o["@"]=t}}},(o=(n=t)&&n.define)&&o.amd?o("rlite",[],r):e.exports?e.exports=r():n.Rlite=r()}),N=function(e){return function(t,n,r){for(var o in n)o in S&&(n[S[o]]=n[o],delete n[o]);return e(t,n,r)}},S={class:"className",for:"htmlFor","http-equiv":"httpEquiv"};var k=1,O=2,x=3,C=4,j=5,E=6,R=7,L=8,T=9,V=10,I=11,P=12,Q=13,$=14;function q(e){return e===T||e===V}var U=function(e,t){var n=function(n,r,o){var i=t[n];return i?i(r,o):e(n,r,o)},r=function(e,t){t||(t={comments:!0});var n=t.concat||function(e,t){return String(e)+String(t)};return!1!==t.attrToProp&&(e=N(e)),function(o){for(var i=arguments,u=k,s="",a=arguments.length,c=[],l=0;l<o.length;l++)if(l<a-1){var f=i[l+1],h=S(o[l]),d=u;d===V&&(d=L),d===T&&(d=L),d===R&&(d=L),d===C&&(d=j),h.push([0,d,f]),c.push.apply(c,h)}else c.push.apply(c,S(o[l]));var p=[null,{},[]],v=[[p,-1]];for(l=0;l<c.length;l++){var g=v[v.length-1][0],m=(h=c[l])[0];if(m===O&&/^\//.test(h[1])){var y=v[v.length-1][1];v.length>1&&(v.pop(),v[v.length-1][0][2][y]=e(g[0],g[1],g[2].length?g[2]:void 0))}else if(m===O){var b=[h[1],{},[]];g[2].push(b),v.push([b,g[2].length-1])}else if(m===j||0===m&&h[1]===j){for(var w,A="";l<c.length;l++)if(c[l][0]===j)A=n(A,c[l][1]);else{if(0!==c[l][0]||c[l][1]!==j)break;if("object"!=typeof c[l][2]||A)A=n(A,c[l][2]);else for(w in c[l][2])c[l][2].hasOwnProperty(w)&&!g[1][w]&&(g[1][w]=c[l][2][w])}c[l][0]===I&&l++;for(var N=l;l<c.length;l++)if(c[l][0]===L||c[l][0]===j)g[1][A]?""===c[l][1]||(g[1][A]=n(g[1][A],c[l][1])):g[1][A]=r(c[l][1]);else{if(0!==c[l][0]||c[l][1]!==L&&c[l][1]!==j){!A.length||g[1][A]||l!==N||c[l][0]!==x&&c[l][0]!==P||(g[1][A]=A.toLowerCase()),c[l][0]===x&&l--;break}g[1][A]?""===c[l][2]||(g[1][A]=n(g[1][A],c[l][2])):g[1][A]=r(c[l][2])}}else if(m===j)g[1][h[1]]=!0;else if(0===m&&h[1]===j)g[1][h[2]]=!0;else if(m===x);else if(m===$)y=v[v.length-1][1],v.pop(),v[v.length-1][0][2][y]=e(g[0],g[1],g[2].length?g[2]:void 0);else if(0===m&&h[1]===k)void 0===h[2]||null===h[2]?h[2]="":h[2]||(h[2]=n("",h[2])),Array.isArray(h[2][0])?g[2].push.apply(g[2],h[2]):g[2].push(h[2]);else if(m===k)g[2].push(h[1]);else if(m!==I&&m!==P)throw new Error("unhandled: "+m)}if(p[2].length>1&&/^\s*$/.test(p[2][0])&&p[2].shift(),p[2].length>2||2===p[2].length&&/\S/.test(p[2][1]))throw new Error("multiple root elements must be wrapped in an enclosing tag");return Array.isArray(p[2][0])&&"string"==typeof p[2][0][0]&&Array.isArray(p[2][0][2])&&(p[2][0]=e(p[2][0][0],p[2][0][1],p[2][0][2])),p[2][0];function S(e){var n=[];u===R&&(u=C);for(var r=0;r<e.length;r++){var o=e.charAt(r);u===k&&"<"===o?(s.length&&n.push([k,s]),s="",u=O):">"===o&&"/"===e.charAt(r-1)?(n.push([$]),s="",u=k):">"===o&&"-"===e.charAt(r-1)&&"-"===e.charAt(r-2)?(n.push([$]),s="",u=k):">"!==o||q(u)||u===Q?u===Q&&/-$/.test(s)&&"-"===o?(t.comments&&n.push([L,s.substr(0,s.length-1)],[x]),s="",u=k):u===O&&/^!--$/.test(s)?(t.comments&&n.push([O,s],[j,"comment"],[I]),s=o,u=Q):u===k||u===Q?s+=o:u===O&&"/"===o&&s.length?(n.push([O,s]),s="",u=k):u===O&&/\s/.test(o)?(n.push([O,s]),s="",u=C):u===O?s+=o:u===C&&/[^\s"'=/]/.test(o)?(u=j,s=o):u===C&&/\s/.test(o)?(s.length&&n.push([j,s]),n.push([P])):u===j&&/\s/.test(o)?(n.push([j,s]),s="",u=E):u===j&&"="===o?(n.push([j,s],[I]),s="",u=R):u===j?s+=o:u!==E&&u!==C||"="!==o?u!==E&&u!==C||/\s/.test(o)?u===R&&'"'===o?u=V:u===R&&"'"===o?u=T:u===V&&'"'===o?(n.push([L,s],[P]),s="",u=C):u===T&&"'"===o?(n.push([L,s],[P]),s="",u=C):u!==R||/\s/.test(o)?u===L&&/\s/.test(o)?(n.push([L,s],[P]),s="",u=C):u!==L&&u!==T&&u!==V||(s+=o):(u=L,r--):(n.push([P]),/[\w-]/.test(o)?(s+=o,u=j):u=C):(n.push([I]),u=R):(u===O?n.push([O,s]):u===j?n.push([j,s]):u===L&&s.length&&n.push([L,s]),n.push([x]),s="",u=k)}return u===k&&s.length?(n.push([k,s]),s=""):u===L&&s.length?(n.push([L,s]),s=""):u===V&&s.length?(n.push([L,s]),s=""):u===T&&s.length?(n.push([L,s]),s=""):u===j&&(n.push([j,s]),s=""),n}};function r(e){return"function"==typeof e?e:"string"==typeof e?e:e&&"object"==typeof e?e:n("",e)}}(n);return r.h=n,r},J=n(function(e){e.exports=function(e){window.addEventListener("hashchange",e,!1),window.addEventListener("popstate",e,!1);var t=window.history.pushState;window.history.pushState=function(n){for(var r=[],o=arguments.length-1;o-- >0;)r[o]=arguments[o+1];var i=t.apply(history,[n].concat(r));return e({state:n}),i}}}),K=function(e){e=e||{},this.defaultRoute=e.defaultRoute||"/404",this.webStorage=e.webStorage,this.router=A(),this.internalRouter={},this.engine=new c};return K.prototype.addActions=function(e){return this.engine.addActions(e),this},K.prototype.addListener=function(e){return this.engine.addListener(e),this},K.prototype.addRoute=function(e,t,n){var r=this;return n&&n.forEach(function(n){var o=(e+n.path).split("//").join("/");r.addRoute(o,function(e,r,o,i){var u=n.component(e,r,o,i);return t(e,r,o,u)},n.subroutes)}),this.internalRouter[e]=function(e){return function(n,r){return t(n,r,e)}},this.router=A(this.internalRouter[this.defaultRoute],this.internalRouter),this},K.prototype.start=function(e,t){var n=this;return this.engine.addListener(function(r,o){n.mount(e,t,r,o)}),this.webStorage&&(this.engine.addActions(i(this.webStorage).actions),this.engine.addListener(i(this.webStorage).listener)),J(function(){n.mount(e,t)}),this.mount(e,t),this},K.prototype.mount=function(e,t,n,r){var o="string"==typeof e?document.querySelector(e):e;if(null===o&&console.warn("Tram-One: could not find target, is the element on the page yet?"),!o.firstElementChild){var i=document.createElement("div");o.appendChild(i)}var u=o.firstElementChild,s=t||window.location.href.replace(window.location.origin,"");return y(u,this.toNode(s,n,r)),this},K.prototype.toNode=function(e,t,n){return this.router(e)(t||this.engine.store,n||this.engine.actions)},K.prototype.toString=function(e,t){return this.toNode(e,t).outerHTML},K.dom=function(e,t){return U(o(e),t||{})},K.html=function(e){return K.dom(null,e)},K.svg=function(e){return K.dom("http://www.w3.org/2000/svg",e)},K.route=function(){return function(e,t,n){return{path:e,component:t,subroutes:n}}},K});
